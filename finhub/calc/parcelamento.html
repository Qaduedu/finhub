<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Parcelamento e juros | FinHub</title>
  <meta name="description" content="Calcule parcela, total pago e juros em compras parceladas."/>
  <link rel="stylesheet" href="../assets/style.css"/>
  <link rel="icon" href="../assets/favicon.svg" type="image/svg+xml"/>
</head>
<body>
<header class="nav">
  <div class="container navInner">
    <a class="brand" href="../index.html"><div class="logo"></div><span>FinHub</span></a>
    <nav class="navLinks">
      <a class="pill" href="../calculadoras.html">Calculadoras</a>
      <a class="pill" href="../tabelas.html">Tabelas</a>
      <a class="pill" href="../faq.html">FAQ</a>
      <a class="pill" href="../sobre.html">Sobre</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <div class="card"><div class="cardPad">
      <h1 class="h1">Parcelamento e juros</h1>
      <p class="p">Descubra a parcela (aprox.), o total pago e quanto de juros você está aceitando sem perceber.</p>
    </div></div>
  </section>

  <section class="grid" style="margin-top:14px">
    <div class="col8">
      <div class="card"><div class="cardPad">
        <h2 class="h2">Parâmetros</h2>

        <form class="form" id="form">
          <div class="grid">
            <div class="col6 field">
              <label for="valor">Valor à vista (R$)</label>
              <input id="valor" inputmode="decimal" value="2000">
            </div>
            <div class="col6 field">
              <label for="parcelas">Número de parcelas</label>
              <input id="parcelas" inputmode="numeric" value="12">
            </div>
            <div class="col6 field">
              <label for="taxa">Juros do parcelamento (% ao mês)</label>
              <input id="taxa" inputmode="decimal" value="2,5">
              <div class="help">Se não souber, teste 2% a 5% e veja a diferença.</div>
            </div>
            <div class="col6 field">
              <label for="entrada">Entrada (R$) (opcional)</label>
              <input id="entrada" inputmode="decimal" value="0">
            </div>
          </div>

          <div class="btnRow">
            <button class="btn primary" type="submit">Calcular</button>
            <button class="btn" type="button" id="reset">Reset</button>
          </div>
        </form>

        <div style="height:12px"></div>
        <div class="result" id="out" aria-live="polite">
          <div class="big">—</div>
          <div class="sub">Preencha os campos e clique em calcular.</div>
        </div>

        <div style="height:12px"></div>
        <div class="notice">
          Modelo aproximado (tabela Price). Lojista pode usar cálculo diferente, mas isso já dá noção do estrago.
        </div>
      </div></div>
    </div>

    <div class="col4">
      <div class="ad"><b>Slot de anúncio</b><br/>Lateral.</div>
      <div style="height:12px"></div>
      <div class="card"><div class="cardPad">
        <h2 class="h2">Relacionado</h2>
        <div class="btnRow">
          <a class="btn" href="juros-compostos.html">Juros compostos</a>
          <a class="btn" href="comparar-opcoes.html">Comparar opções</a>
        </div>
      </div></div>
    </div>
  </section>

  <footer class="footer">
    <div class="footerGrid">
      <div><b>FinHub</b><br/><small><a href="../privacidade.html">Privacidade</a> · <a href="../termos.html">Termos</a></small></div>
      <div style="text-align:right"><small><a href="../calculadoras.html">Voltar</a></small></div>
    </div>
  </footer>
</main>

<script type="module">
  import { $, toNumberBR, formatBRL, setActiveNav, clamp } from "../assets/app.js";
  setActiveNav();

  const valorEl = $("#valor");
  const parcelasEl = $("#parcelas");
  const taxaEl = $("#taxa");
  const entradaEl = $("#entrada");
  const out = $("#out");

  function calc(){
    const valor = toNumberBR(valorEl.value);
    const entrada = toNumberBR(entradaEl.value);
    const parcelas = Math.round(toNumberBR(parcelasEl.value));
    const taxaPct = toNumberBR(taxaEl.value);

    if (![valor, entrada, parcelas, taxaPct].every(Number.isFinite)){
      out.innerHTML = `<div class="big">—</div><div class="sub">Preencha tudo com números válidos.</div>`;
      return;
    }

    const principal = Math.max(0, valor - entrada);
    const n = clamp(parcelas, 1, 120);
    const i = taxaPct/100;

    // PMT Price: P * i / (1 - (1+i)^-n)
    let pmt;
    if (i === 0){
      pmt = principal / n;
    }else{
      pmt = principal * i / (1 - Math.pow(1+i, -n));
    }

    const totalParcelado = pmt * n;
    const totalPago = totalParcelado + entrada;
    const juros = totalPago - valor;

    out.innerHTML = `
      <div class="big">Parcela: ${formatBRL(pmt)}</div>
      <div class="sub">
        Total pago: <b>${formatBRL(totalPago)}</b><br/>
        Juros estimados: <b>${formatBRL(juros)}</b><br/>
        Entrada: <b>${formatBRL(entrada)}</b> | Parcelas: <b>${n}</b> | Taxa: <b>${taxaPct.toLocaleString("pt-BR")}%</b> a.m.
      </div>
    `;
  }

  $("#form").addEventListener("submit", (e)=>{ e.preventDefault(); calc(); });
  $("#reset").addEventListener("click", ()=>{
    valorEl.value="2000"; parcelasEl.value="12"; taxaEl.value="2,5"; entradaEl.value="0";
    calc();
  });
  calc();
</script>
</body>
</html>
